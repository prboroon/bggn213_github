---
title: "Class09"
author: "Parnaz Boroon PID:A13557370"
format: pdf
---
## The PDB Database

The main respository for biomolecular structure data is the Protein Data Bank (PDB).

Let's have a quick look at the composition of this database:

## QUESTION 1: What percentage of structures in the PDB are solved by X-Ray and Electron Microscopy?

```{r}
stats <-read.csv("Data Export Summary.csv")

stats$X.ray <- as.numeric(gsub(",", "", stats$X.ray))
stats$EM <- as.numeric(gsub(",", "", stats$EM))
stats$Total <- as.numeric(gsub(",", "", stats$Total))

total_xray <- sum(stats$X.ray, na.rm = TRUE)
total_em <- sum(stats$EM, na.rm = TRUE)
total_all <- sum(stats$Total, na.rm = TRUE)

percent_xray <- (total_xray / total_all) * 100
percent_em <- (total_em / total_all) * 100

cat("Percentage solved by X-Ray:", round(percent_xray, 2), "%\n")
cat("Percentage solved by Electron Microscopy:", round(percent_em, 2), "%\n")


```

This is annoying lets try a different import function from the **readr** package.
```{r}
library("readr")

stats <- read_csv("Data Export Summary.csv")

n.total <- sum(stats$Total)
n.xray <- sum(stats$`X-ray`)
n.em <- sum(stats$EM)

round(n.xray/n.total * 100,3)
round(n.em/n.total * 100,3)


```


## QUESTION 2: What proportion of structures in the PDB are protein?
```{r}
stats <- read_csv("Data Export Summary.csv")

n.prot <- sum(stats$Total[1])
row.total <- sum(stats$Total)
round((n.prot/row.total)*100, digits = 2)
```


## QUESTION 3: Make a bar plot overview
```{r}
library(ggplot2)
library(tidyr)
library(dplyr)

# Read CSV
my_data <- read.csv("Data Export Summary.csv")

# Clean numeric columns (matching your actual names)
cols_to_fix <- c("X.ray", "EM", "NMR", "Integrative", "Multiple.methods", "Neutron", "Other", "Total")
my_data[cols_to_fix] <- lapply(my_data[cols_to_fix], function(x) as.numeric(gsub(",", "", x)))

# Sort Molecular.Type by total number of structures (descending)
my_data <- my_data %>%
  arrange(desc(Total)) %>%
  mutate(Molecular.Type = factor(Molecular.Type, levels = Molecular.Type))

# Reshape from wide → long
long_data <- my_data %>%
  pivot_longer(
    cols = c("X.ray", "EM", "NMR", "Integrative", "Multiple.methods", "Neutron", "Other"),
    names_to = "Method",
    values_to = "Count"
  )

# Create stacked bar plot
ggplot(long_data, aes(x = Molecular.Type, y = Count, fill = Method)) +
  geom_bar(stat = "identity") +
  scale_y_continuous(labels = scales::comma) +
  labs(
    title = "Overview of PDB Structures by Molecular Type and Experimental Method",
    x = "Molecular Type",
    y = "Number of Structures",
    fill = "Experimental Method"
  ) +
  theme_minimal(base_size = 14) +
  theme(
    plot.title = element_text(face = "bold", hjust = 0.5),
    axis.text.x = element_text(angle = 30, hjust = 1),
    legend.position = "right"
  )

```

## Visualizing structure data

The Mol* viewer is embedded in many bioinformatics websites. 

I can insert any figure or image file using markdown format

![HIV-Pr dimer with bound inhibitor](1HSG.png)

## QUESTION 4: Water molecules normally have 3 atoms. Why do we see just one atom per water molecule in this structure?
If there were more than just one atom per water molecule in this structure, we wouldn't be able to see 

## QUESTION 5: There is a critical “conserved” water molecule in the binding site. Can you identify this water molecule? What residue number does this water molecule have?
H308
![](H308.png)

## QUESTION 6: Generate and save a figure clearly showing the two distinct chains of HIV-protease along with the ligand. You might also consider showing the catalytic residues ASP 25 in each chain and the critical water (we recommend “Ball & Stick” for these side-chains). Add this figure to your Quarto document.
![](polymer.png)

## Bio3D package for structural bioinformatics

We can use the bio3d package to read and analyze biomolecular data in R:
```{r}
library(bio3d)

hiv <- read.pdb("1hsg")
hiv
```
```{r}
head(hiv$atom)
```

```{r}
pdbseq(hiv)
```

Let's trim to chain A and get just it's sequence: 
```{r}
chainA <- trim.pdb(hiv, chain="A")
chainA.seq <- pdbseq(chainA)
```


## QUESTION 7 How many amino acid residues are there in this pdb object?
2
## QUESTION 8 Name one of the two non-protein residues?
HOH (127)
## QUESTION 9 How many protein chains are in this structure?
2 [A, B]


## Prediction of functional motions

We can run a Normal mode analysis (NMA) to predict large scale motions/flexibility/dynamics of any biomolecule that can read into R. 

Let's look at ADK and chain A only!

```{r}
adk <- read.pdb("1ake")

adk_A <- trim.pdb (adk, chain="A")
adk_A

m <- nma(adk_A)
plot(m)
```

Let's write out a "trajectory" of prediction
```{r}
mktrj(m,file="adk_nma.pdb")
```

## Play with 3D viewing in R

We can use the new **bio3dview** package, which is not yet on CRAN, to render interactive 3D views in R and HTML quarto output reports.

To install from GitHub we can use the **pak** package.

## QUESTION 10: Which of the packages above is found only on BioConductor and not CRAN?
Biocmanager
## QUESTION 11: Which of the above packages is not found on BioConductor or CRAN?
devtools
## QUESTION 12: True or False? Functions from the devtools package can be used to install packages from GitHub and BitBucket?
True
## QUESTION 13: How many amino acids are in this sequence, i.e. how long is this sequence?
214

```{r}
# Install packages in the R console NOT your Rmd/Quarto file

install.packages("bio3d")
install.packages("devtools")
install.packages("BiocManager")

BiocManager::install("msa")
devtools::install_bitbucket("Grantlab/bio3d-view")
```


## Comparitive analysis of protein structure

Starting with a sequence or structure ID (accession number) let's run a complete analysis pipeline

```{r}
library(bio3d)

id <- "1ake_A"

aa<-get.seq(id)
aa
```

```{r, cache=TRUE}
blast <- blast.pdb(aa)
hits <- plot(blast)
```




```{r}
hits$pdb.id
```


```{r}
# Download releated PDB files
files <- get.pdb(hits$pdb.id, path="pdbs", split=TRUE, gzip=TRUE)
```

```{r}
# Align releated PDBs
pdbs <- pdbaln(files, fit = TRUE, exefile="msa")
```

```{r}
pc.xray <- pca(pdbs)
plot(pc.xray)
```

```{r}
plot(pc.xray,1:2)
```

```{r}
mktrj(pc.xray, file="pca_results.pdb")
```

```{r}
library(bio3d.view)

view.pca(pc.xray)
```

